* Update flattening logic with help of Vashal